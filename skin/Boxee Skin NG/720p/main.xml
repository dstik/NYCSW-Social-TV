<?xml version="1.0"?>
<window type="window" id="14000">
			<onload lang="python">
<![CDATA[
import sys
sys.path.append('.')
import logging
import urllib
import urllib2
import mc
import jobmanager
import random
import getpass
import simplejson as json

'''
name_list = ['Shane Reiser', 
             "Charlie O'Donnell", 
             'Fred Wilson', 
             'Chris Dixon', 
             'Mark Suster', 
             'Paul Buchheit', 
             'Paul Graham', 
             'Bill Gates', 
             'Steve Ballmer', 
             'Steve Jobs', 
             'Larry Page',
             'Sergey Brin'
]
'''
logging.error('##################')
config = mc.GetApp().GetLocalConfig()
user_id = config.GetValue('user_id')
if not user_id:
    user_id = 'boxeer_' + str(random.randrange(100000, 999999))
    config.SetValue("user_id", user_id)
user_name = config.GetValue('user_name')
if not user_name:
    #user_name = name_list[random.randrange(0, len(name_list))]
    user_name = getpass.getuser()
    config.SetValue("user_name", user_name)
logging.error('Logging in USER_ID: ' + user_id)
logging.error('Logging in USER_NAME: ' + user_name)
urllib2.urlopen("http://boxee.coviewer.tv:8124/boxee/userLogin/" + user_id + "/" + urllib.quote(user_name))

class PollingJob(jobmanager.BoxeeJob):
    # Add your own variables to constructor.
    def __init__(self, message, interval):
        self.message = message
        self.interval = interval
        # Be sure to always inherit the constructor from the base BoxeeJob class.
        jobmanager.BoxeeJob.__init__(self, "PollingJob", interval)
    
    def process(self):
        # This is the base function that is always called for every job and the one you should extend.
        logging.error('JOB-JOB-JOB-JOB-JOB-JOB')
        data_obj = urllib2.urlopen("http://2.iridium-flares.appspot.com/coviewer")
#        data_obj = urllib2.urlopen("http://boxee.coviewer.tv:8124/boxee/getUserList")
        if data_obj:
            boxeeItems = mc.ListItems()
            data = json.load(data_obj)
            for item in data:
                boxeeItem = mc.ListItem( mc.ListItem.MEDIA_VIDEO_CLIP )
    	        logging.error('LIST ITEM    : ' + str(item))
    	        logging.error('LIST ITEM VID: ' + item[u'url'])
                boxeeItem.SetPath(str(item[u'url']))
                boxeeItems.append(boxeeItem)
    	        logging.error('LIST SIZE: ' + str(len(boxeeItems)))
            #something
        logging.error('JOB-JOB-JOB-JOB-JOB-JOB')


#Process job queue every 30 seconds (instead of default 10):
myJobManager = jobmanager.BoxeeJobManager(5)

#Add polling job to Job Manager:
myJob = PollingJob("MESSAGE GOES HERE", 5)
myJobManager.addJob(myJob)

#Start Job Manager:
myJobManager.start()
]]>
		   </onload>
		<onunload lang="python">
<![CDATA[
logging.error('##################')
config = mc.GetApp().GetLocalConfig()
user_id = config.GetValue("username")
logging.error('Logging out USER_ID: ' + user_id)
urllib2.urlopen("http://boxee.coviewer.tv:8124/boxee/userLogout/" + user_id)
if mc.GetPlayer().IsPlaying():
    mc.GetPlayer().Stop()
logging.error('##################')
]]>
		   </onunload>
	<defaultcontrol always="true">120</defaultcontrol>
	<controls>
		<control type="group">
			<control type="image">
				<posx>300</posx>
				<posy>0</posy>
				<width>980</width>
				<height>720</height>
				<texture>backgroundgrey.png</texture>
			</control>
			<control type="image">
				<posx>1050</posx>
				<posy>20</posy>
				<width>200</width>
				<height>203</height>
				<texture>logo.png</texture>
			</control>
         <control type="image">
             <posx>0</posx>
             <posy>0</posy>
			<width>300</width>
			<height>720</height>
             <texture>sidebar.png</texture>
          </control>


		  <control type="image">
             <posx>20</posx>
             <posy>10</posy>
			<width>250</width>
			<height>37</height>
             <texture>sideheader.png</texture>
          </control>
		  <control type="image">
             <posx>465</posx>
             <posy>10</posy>
			<width>500</width>
			<height>58</height>
             <texture>searchbar.png</texture>
          </control>

    <control type="edit" id="9001">   
       <posx>580</posx>   
       <posy>10</posy>   
       <width>380</width>   
       <height>58</height>   
       <onleft>-</onleft>   
       <onright>-</onright>   
       <onup>-</onup>   
       <ondown>9002</ondown>   
       <onprev>9003</onprev>   
       <onnext>9002</onnext>   
       <label>-</label>   
       <textoffsetx>8</textoffsetx>   
       <align>left</align>   
       <aligny>center</aligny>   
       <font>font28</font>   
       <textcolor>white</textcolor>
       <texturenofocus>login_textbox.png</texturenofocus>
       <texturefocus>login_textbox_on.png</texturefocus>
       <ontextchange lang="python">
<![CDATA[
]]>   
       </ontextchange>
    </control>


         <control type="image">
             <posx>370</posx>
             <posy>90</posy>
			<width>800</width>
			<height>600</height>
             <texture>tv.png</texture>
          </control>
			<control type="group" id="110">
				<control type="videowindow">
					<posx>472</posx>
					<posy>170</posy>
					<width>590</width>
					<height>518</height>
				</control>
				<control type="image">
					<visible>!Player.HasVideo</visible>
					<posx>180</posx>
					<posy>150</posy>
					<width>565</width>
					<height>380</height>
					<texture>$INFO[Container(111).ListItem.Thumb]</texture>
				</control>
				<control type="button" id="114">
					<posx>418</posx>
					<posy>280</posy>
					<width>120</width>
					<height>120</height>
					<label>-</label>
					<texturenofocus>-</texturenofocus>
					<texturefocus>osd_control_play_on.png</texturefocus>
					<visible>Player.HasVideo</visible>
					<onclick>ActivateWindow(FullscreenVideo)</onclick>
					<hitrect x="180" y="150" w="565" h="380"/>
					<onright>111</onright>
				</control>
			</control>
		</control>
	</controls>
</window>

